<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Local Event Creator</title>
<style>
body {
  font-family: system-ui, sans-serif;
  margin: 0; padding: 0; background: #f5f5f5;
}
header {
  background: linear-gradient(90deg,#007aff,#5856d6);
  color: white; padding: 15px; text-align: center;
}
section { padding: 15px; }
input, select, textarea {
  width: 100%; padding: 8px; margin-top: 5px; margin-bottom: 10px;
  border-radius: 6px; border: 1px solid #ccc; box-sizing: border-box;
}
textarea { resize: vertical; }
button {
  background: #007aff; color: white; border: none;
  padding: 10px 16px; border-radius: 8px; font-size: 16px;
  cursor: pointer;
}
button:disabled { background: gray; cursor: not-allowed; }
.event-card {
  background: white; margin: 10px 0; padding: 15px;
  border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1);
}
.event-card img {
  width: 100%; border-radius: 10px; margin-bottom: 10px;
}
.flex { display: flex; gap: 10px; flex-wrap: wrap; }
label { font-weight: 600; display: block; }
#photoPreview {
  width: 100%; max-height: 200px; object-fit: contain;
  border-radius: 8px; display: none; margin-top: 10px;
}
.event-actions { display:flex; justify-content: space-between; gap:10px; margin-top:10px; }
.event-actions button { flex:1; }
#paymentUrlContainer { display:none; }
</style>
</head>
<body>
<header><h1>Event Creator</h1></header>

<section id="formSection">
  <h2 id="formTitle">Create Event</h2>
  <label>Event Name</label>
  <input id="eventName" list="eventNameList" type="text" placeholder="Enter name">
  <datalist id="eventNameList"></datalist>

  <div class="flex">
    <div style="flex:1">
      <label>Duration Hours</label>
      <input id="durationHours" type="number" min="0" max="72" value="0">
    </div>
    <div style="flex:1">
      <label>Duration Minutes</label>
      <input id="durationMinutes" type="number" min="0" max="59" value="0">
    </div>
  </div>

  <label>Weather</label>
  <select id="weather">
    <option>Sunny</option><option>Clear</option><option>Partly Cloudy</option>
    <option>Cloudy</option><option>Windy</option><option>Rainy</option>
    <option>Thunderstorm</option><option>Snowy</option><option>Foggy</option><option>Indoor</option>
  </select>

  <label>Description</label>
  <textarea id="eventDescription" rows="3"></textarea>

  <label>Age Group</label><input id="age" type="text" placeholder="e.g. 21+">
  <label>Venue Type</label><input id="venueType" type="text" placeholder="Outdoor Park">
  <label>Theme</label><input id="eventTheme" type="text" placeholder="Fitness Mixer">

  <label>Dress Code</label><input id="dressCode" type="text">
  <label>What To Bring</label><textarea id="whatToBring" rows="2"></textarea>

  <label>Pandora Links (comma separated)</label>
  <input id="pandoraLinks" type="text" placeholder="https://pandora.com/song,...">
  <label>Other Links (comma separated)</label>
  <input id="otherLinks" type="text" placeholder="https://example.com,...">

  <label><input id="isPaid" type="checkbox"> Paid Event</label>
  <div id="paymentUrlContainer">
    <label>Payment URL</label>
    <input id="paymentUrl" type="url" placeholder="https://cash.app/$username or crypto link">
  </div>

  <h3>Activities</h3>
  <label><input id="isDrinking" type="checkbox"> Drinking</label>
  <label><input id="isSmoking" type="checkbox"> Smoking</label>
  <label><input id="isCannabis" type="checkbox"> Cannabis</label>

  <h3>Gender Welcome</h3>
  <label><input id="isMale" type="checkbox"> Males</label>
  <label><input id="isFemale" type="checkbox"> Females</label>
  <label><input id="isOther" type="checkbox"> Other</label>

  <label>Event Photo</label>
  <input id="eventPhoto" type="file" accept="image/*">
  <img id="photoPreview" alt="Preview">

  <div class="flex">
    <button id="saveEvent">Save Event</button>
    <button id="cancelEdit" style="display:none;background:#888;">Cancel Edit</button>
  </div>
</section>

<section>
  <h2>Saved Events</h2>
  <div id="eventList"></div>
</section>

<script>
const fields = [
  'eventName','durationHours','durationMinutes','weather','eventDescription',
  'age','venueType','eventTheme','dressCode','whatToBring',
  'pandoraLinks','otherLinks','isPaid','paymentUrl','isDrinking','isSmoking','isCannabis',
  'isMale','isFemale','isOther'
];
let currentPhotoBase64="";
let editingIndex=null;

function getLocalData(){return JSON.parse(localStorage.getItem('events')||'[]');}
function saveLocalData(data){localStorage.setItem('events',JSON.stringify(data));}

document.getElementById('isPaid').addEventListener('change',e=>{
  document.getElementById('paymentUrlContainer').style.display = e.target.checked ? 'block':'none';
});

document.getElementById('eventPhoto').addEventListener('change',e=>{
  const file=e.target.files[0]; if(!file)return;
  const reader=new FileReader();
  reader.onload=ev=>{
    currentPhotoBase64=ev.target.result;
    const prev=document.getElementById('photoPreview');
    prev.src=currentPhotoBase64; prev.style.display="block";
  };
  reader.readAsDataURL(file);
});

function loadDropdowns(){
  const names=JSON.parse(localStorage.getItem('eventNames')||'[]');
  const dl=document.getElementById('eventNameList'); dl.innerHTML='';
  names.forEach(n=>{let o=document.createElement('option');o.value=n;dl.appendChild(o);});
}

function displayEvents(){
  const list=document.getElementById('eventList');
  list.innerHTML='';
  const events=getLocalData();
  events.forEach((e,i)=>{
    const div=document.createElement('div');
    div.className='event-card';
    div.innerHTML=`
      ${e.photo?`<img src="${e.photo}" alt="Event Photo">`:''}
      <h3>${e.eventName}</h3>
      <p><b>Duration:</b> ${e.durationHours}h ${e.durationMinutes}m | <b>Weather:</b> ${e.weather}</p>
      <p><b>Theme:</b> ${e.eventTheme} | <b>Venue:</b> ${e.venueType}</p>
      <p>${e.eventDescription}</p>
      ${e.isPaid && e.paymentUrl ? `<p><b>Payment Link:</b> <a href="${e.paymentUrl}" target="_blank">${e.paymentUrl}</a></p>`:''}
      <div class="event-actions">
        <button onclick="shareEvent(${i})">Share</button>
        <button style="background:#34c759" onclick="editEvent(${i})">Edit</button>
        <button style="background:#ff3b30" onclick="deleteEvent(${i})">Delete</button>
      </div>
    `;
    list.appendChild(div);
  });
}

function shareEvent(index){
  const e=getLocalData()[index];
  let text=`Event: ${e.eventName}
Duration: ${e.durationHours}h ${e.durationMinutes}m
Weather: ${e.weather}
Theme: ${e.eventTheme}
Venue: ${e.venueType}
Description: ${e.eventDescription}
Links: ${e.pandoraLinks}, ${e.otherLinks}`;
  if(e.isPaid && e.paymentUrl) text+=`\nPayment: ${e.paymentUrl}`;
  if(navigator.canShare && e.photo){
    fetch(e.photo).then(res=>res.blob()).then(blob=>{
      const file=new File([blob],`${e.eventName}.png`,{type:blob.type});
      navigator.share({title:e.eventName,text,files:[file]}).catch(console.log);
    });
  }else if(navigator.share){
    navigator.share({title:e.eventName,text}).catch(console.log);
  }else alert("Sharing not supported.");
}

function saveEvent(){
  const eventData={};
  fields.forEach(f=>{
    const el=document.getElementById(f);
    if(!el)return;
    eventData[f]=el.type==='checkbox'?el.checked:el.value.trim();
  });
  if(!eventData.eventName){alert("Please enter event name");return;}
  eventData.photo=currentPhotoBase64;
  const data=getLocalData();
  if(editingIndex!==null){data[editingIndex]=eventData;editingIndex=null;}
  else data.push(eventData);
  saveLocalData(data);
  let names=JSON.parse(localStorage.getItem('eventNames')||'[]');
  if(!names.includes(eventData.eventName)){names.push(eventData.eventName);localStorage.setItem('eventNames',JSON.stringify(names));}
  resetForm(); loadDropdowns(); displayEvents();
  alert("Event saved locally!");
}

function editEvent(i){
  const e=getLocalData()[i];
  fields.forEach(f=>{
    const el=document.getElementById(f);
    if(!el)return;
    if(el.type==='checkbox') el.checked=!!e[f];
    else el.value=e[f]||'';
  });
  document.getElementById('paymentUrlContainer').style.display=e.isPaid?'block':'none';
  currentPhotoBase64=e.photo||"";
  const preview=document.getElementById('photoPreview');
  if(e.photo){preview.src=e.photo;preview.style.display="block";}else preview.style.display="none";
  editingIndex=i;
  document.getElementById('formTitle').textContent="Edit Event";
  document.getElementById('cancelEdit').style.display="inline-block";
  window.scrollTo({top:0,behavior:"smooth"});
}

function deleteEvent(i){
  if(!confirm("Delete this event?"))return;
  const data=getLocalData();
  data.splice(i,1); saveLocalData(data);
  displayEvents();
}

function resetForm(){
  fields.forEach(f=>{
    const el=document.getElementById(f);
    if(!el)return;
    if(el.type==='checkbox')el.checked=false; else el.value='';
  });
  document.getElementById('paymentUrlContainer').style.display='none';
  document.getElementById('photoPreview').style.display="none";
  document.getElementById('eventPhoto').value="";
  currentPhotoBase64="";
  document.getElementById('formTitle').textContent="Create Event";
  document.getElementById('cancelEdit').style.display="none";
}

document.getElementById('saveEvent').addEventListener('click',saveEvent);
document.getElementById('cancelEdit').addEventListener('click',()=>{resetForm();editingIndex=null;});
window.addEventListener('load',()=>{loadDropdowns();displayEvents();});
</script>
</body>
</html>
